\documentclass[a4paper,12pt, UTF-8]{article}

\usepackage[dvipsnames]{xcolor} % Code highlighting color
\usepackage[catalan]{babel} % Language 
\usepackage{indentfirst}
\usepackage{fontspec} 
\usepackage{fullpage}
\usepackage[a4paper, margin=2cm]{geometry} % To change the margins
\usepackage{graphicx} % Insert images
\usepackage[hidelinks]{hyperref} % Links color
\usepackage[final]{pdfpages}
\usepackage{ragged2e}
\usepackage{wrapfig} %To Text wrap
\usepackage{listings} % Add code
\usepackage{verbatim}
\usepackage{nameref}
\usepackage{tikz}
\usepackage{subcaption}
\usepackage{multirow}
\usepackage{colortbl}

\setlength{\parskip}{0.7em}
%\setlength{\parindent}{1cm}
\linespread{1.2}

\title{
	\Huge
	\textbf{Pràctica 3} \\ 
	\scshape Planificador
}
\author{
	Marc Asenjo i Ponce de León \and
	Joan Marcè i Igual \and
	Iñigo Moreno i Caireta
}
\date{\today}

\begin{document}

\maketitle

\begin{figure}
	\centering
	\includegraphics[width=0.8\linewidth]{./simple_FIB}
\end{figure}

\newpage

\tableofcontents

\newpage

\section{Introducció}

\subsection{El problema}

Aquest problema és una continuació de la pràctica 2 realitzada. El client després de quedar satisfet amb el nostre sistema de recomanació d'exercicis construït en CLIPS ens demana ara una eina senzilla que, basant-se en exercicis que l'usuari està realitzant en aquest moment i el seu nivell de dificultat (de l'1 al 10), li faci un pla d'entrenament físic quinzenal amb l'objectiu d'aconseguir pujar de nivell un conjunt d'exercicis escollits. El pla d'entrenament ha de tenir en compte que no es pot realitzar un exercici amb nivell $X$ de dificultat si no s'ha realitzat anteriorment el mateix exercici amb dificultat $X - 1$ i que hi ha exercicis que s'han de fer abans que altres. Es defineixen les següents relacions entre exercicis:

\begin{description}
	\item[Exercicis precursors:] un exercici és precursor d'un altre si s'ha de fer abans que l'altre exercici el mateix dia d'entrenament, sense haver-hi cap exercici intercalat entre ells. És una restricció estricta que no es pot trencar.
	\item[Exercicis preparadors:] són exercicis que s'han de fer abans d'un cert exercici el mateix dia d'entrenament però no han d'anar immediatament abans (un exemple són els estiraments, que preparen diversos exercicis per a les sessions d'entrenament). És una restricció estricta que no es pot trencar.
	\item[Exercicis nivell $N + 1$:] serveixen per modelar l'evolució del nivell de dificultat d'un exercici segons passen els dies. Per cada exercici es pot pujar un nivell $N + 1$ només si aquest exercici s'ha realitzat anteriorment al nivell $N$.
\end{description}

Així doncs al sistema se li ha de donar coneixement sobre:

\begin{itemize}
	\item els exercicis que es poden fer al gimnàs
	\item els exercicis predecessors d'un exercici
	\item els exercicis preparadors d'un exercici
	\item els exercicis que l'usuari ja està fent i el nivell al que els fa
	\item els nivells incrementats d'alguns exercicis als que es vol arribar al final de la quinzena.
\end{itemize}

El resultat és un pla d'entrenament que:
\begin{itemize}
	\item reflexa els exercicis mínims que l'usuari ha de realitzar per arribar als nivells objectiu (\emph{important:} el planificador no ha d'omplir el pla amb exercicis extra, només els necessaris per arribar al dia 15 al nivell desitjat. Si sobren espais es sobreentén que se li dona a l'usuari la llibertat per fer altres exercicis suplementaris al pla d'entrenament).
	\item per a cada exercici al pla, indica el dia a fer-lo i a quin nivell per arribar als objectius quinzenals.
	\item per tots els exercicis del pla es compleix en tot moment que els seus predecessors es fan just abans el mateix dia, sense cap exercici intercalat pel mig. 
	\item per tots els exercicis del pla es compleix en tot moment que els seus exercicis preparadors es fan abans el mateix dia (però hi pot haver exercicis intercalats).
	\item per tot exercici del pla amb nivell $N$ es compleix en tot moment que el mateix exercici ha estat realitzat algun dia anterior amb nivell $N$ o $N - 1$.
\end{itemize}

\subsection{Extensions del problema}

Aquest problema consta de diverses extensions per poder obtenir millor nota, les extensions són les següents:

\begin{description}
	\item[Problema bàsic:] Al pla d'entrenament tots els exercicis tenen 0 o 1 preparadors i cap predecessor. El planificador és capaç de trobar un pla per poder realitzar els exercicis al nivell final de la quinzena encadenant exercicis i pujant el nivell si fa falta segons van passant els dies, tenint en compte que cada exercici te un o cap exercici preparador (els estiraments no tenen cap preparador) i que per tot exercici del pla amb nivell $N$ es compleix que en tot moment en el que s'ha realitzat l'exercici anteriorment s'ha fet amb nivell $N$ o $N - 1$.
	\item[Extensió 1:] Els exercicis poden tenir de 0 a N preparadors però cap predecessor. El planificador és capaç de construir un pla per poder realitzar els objectius al nivell desitjat encadenant exercicis i pujant de nivell si fa falta segons van passant els dies, tenint en compte que per a tot exercici que pertany al pla, tots els seus exercicis preparadors pertanyen al pla i estan abans el mateix dia.
	\item[Extensió 2:] Extensió 1 + 	els exercicis 0 o 1 exercici predecessor. El planificador és capaç de construir un pla per poder realitzar els exercicis al nivell objectiu encadenant exercicis i pujant de nivell si fa falta segons els dies, on per a tot exercici que pertany al pla, tots els seus exercicis precursors i preparadors estan co\l.locats el mateix dia i per a tot exercici del pla amb un nivell $N$ es compleix en tot moment que el mateix exercici ha estat realitzat anteriorment amb un nivell $N + 1$
	\item[Extensió 3:] El planificador controla que no hi hagi més de 6 exercicis al dia.
	\item[Extensió 4:] Els exercicis tenen assignat el temps (en minuts) que es triga a realitzar-los (incloent el temps de descans necessari després de l'exercici). El planificador controla que el pla generat no superi els 90 minuts diaris. 
\end{description}

\section{Domini}

\subsection{Tipus de dades}

En aquest domini s'han definit els següents tipus de dades:
\begin{description}
	\item[exercice] Representa un exercici
	\item[day] Identifica un dia
\end{description}

\subsection{Predicats}

En el domini s'han definits predicats diferents en funció de quina extensió havien de complir, fins a l'extensió 3 hi ha els següents predicats:
\begin{description}
	\item[before] Relaciona dos dies i s'utilitza per saber que un dia està abans que un altre (el dia 1 del pla es troba abans que el dia 2 per exemple).
	\item[precursor] Relaciona dos exercicis, el primer és precursor del segon, així és possible satisfer la relació d'un exercici precursor d'un altre.
	\item[preparer] Relaciona dos exercicis, el primer és preparador del segon, així és possible satisfer la relació d'un exercici preparador d'un altre.
	\item[currentDay] identifica el dia actual, és necessari per realitzar tasques com canviar de dia o per saber els exercicis realitzats en un dia.
	\item[exerciceToday] Predicat on s'afegeixen els exercicis realitzats durant un dia en concret, al canviar de dia els exercicis marcats s'han d'eliminar per tornar-los a marcar, si cal, al següent dia. És útil satisfer la relació dels exercicis preparadors.
	\item[lastExerciceToday] S'utilitza per marcar quin ha estat l'últim exercici realitzat en aquell moment durant el dia, és útil per saber complir la relació del exercicis precursors. 
\end{description}

\subsection{Funcions}

Com que s'ha utilitzat \verb|fluent| (necessari per realitzar l'extensió 4). També s'han definit les següents funcions:
\begin{description}
	\item[exLevel] Relaciona un exercici amb el seu nivell
	\item[numExToday] S'utilitza per contar el nombre d'exercicis realitzats durant un dia i així satisfer l'extensió 3 (només utilitzat fins a l'extensió 3).
	\item[exTime] Relaciona un exercici amb la seva duració (només s'utilitza a l'extensió 4).
	\item[timeDay] S'utilitza per contar els minuts totals d'exercicis realitzats i així poder satisfer l'extensió 4 (només s'utilitza a l'extensió 4).
\end{description}

\section{Operadors}

Els operadors escollits han estat dos, un que és el que realitza l'exercici i l'altre que és el que canvia el dia.

\subsection{\texttt{do-exercice}}

La funció d'aquest operador és realitzar un exercici si s'han complert totes les precondicions d'aquest.

\textbf{Precondicions: } 
\begin{itemize}
	\item L'exercici no s'ha realitzat avui encara
	\item Si té un exercici precursor aquest és l'últim que s'ha fet avui
	\item Tots els exercicis preparadors ja s'ha fet avui
	\item (només extensió 3) El nombre d'exercicis fets avui és inferior a 6
	\item (només extensió 4) Els minuts d'exercicis fets avui més la duració de l'exercici són inferiors o iguals a 90.
\end{itemize}

Un cop s'ha realitzat l'exercici es posa aquest exercici com a l'últim realitzat avui, també s'afegeix a la llista d'exercicis realitzats avui, s'incrementa el nivell de l'exercici, (a l'extensió 3) s'incrementa el nombre d'exercicis realitzats i (a l'extensió 4) s'incrementa la duració de l'exercici.

\subsection{\texttt{skip-day}}

La funció d'aquest operador és canviar de dia per poder continuar en la creació del pla d'entrenament. Rep dos dies com a paràmetres i incrementa el dia del dia \verb|d1| al \verb|d2|.

\textbf{Precondicions: }
\begin{itemize}
	\item El dia \verb|d1| és el dia actual en el que s'està treballant
	\item El dia \verb|d2| ve després del dia \verb|d1|.
\end{itemize}

L'efecte de l'operador és marcar tots els exercicis com a no realitzats avui i també marcar que no hi ha cap exercici com a "últim exercici realitzat". A l'extensió 3 marca el nombre d'exercicis realitzats a 0 i a l'extensió 4 posa el nombre de minuts realitzats avui a 0.

\end{document}